---
title: Automatic Release
---

# Automatic Release

## What is Automatic Release?
Automatic release is a feature that allows you to release your app automatically to NPM and manage your packages easier.

<br />


# Instructions

## Creating Folders and Files

1. Create folder `scripts` and create `release.ts` file in it then paste the following code in it:
```ts
import { execSync } from 'child_process'
import pkg from 'fs-extra'
const { readJSONSync } = pkg
import { exit } from 'process'

const { version: oldVersion } = readJSONSync('../package.json')

execSync('cd .. && bumpp --no-commit --no-tag --no-push', { stdio: 'inherit' })

const { version } = readJSONSync('../package.json')

if (oldVersion === version) {
  console.log('canceled')
  process.exit()
}

execSync('cd .. && git add .', { stdio: 'inherit' })
execSync(`cd .. && git commit -m "release v${version}"`, { stdio: 'inherit' })
execSync(`cd .. && git tag -a v${version} -m "v${version}"`, { stdio: 'inherit' })
execSync(`cd .. && git push origin master"`, { stdio: 'inherit' })

console.log(`released v${version}`)
```
2. Create folder `.github` and create `workflows` folder in it and create `release.yml` file in it then paste the following code in it:
```yaml
name: RELEASE
on:
  push:
    branches:
      - master
jobs:
  RELEASE:
    runs-on: ${{ matrix.config.os }}
    name: ${{ matrix.config.os }} (${{ matrix.config.r }})
    strategy:
      matrix:
        config:
          - {os: ubuntu-latest, r: 'release'}
    env:
      GITHUB_PAT: ${{ secrets.GITHUB_TOKEN }}
      R_KEEP_PKG_SOURCE: yes
    if: github.event_name == 'push' && ( github.ref == 'refs/heads/master' || github.ref == 'refs/heads/main' ) && (contains(github.event.head_commit.message, 'release v'))
    steps:
      - name: Checkout repo
        uses: actions/checkout@v2
      - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: install
      - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: dev:prepare
      - uses: borales/actions-yarn@v3.0.0
        with:
          cmd: publish --access=public
          auth-token: ${{ secrets.NPM_AUTH_TOKEN }}
          registry-url: registry.npmjs.org
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

3. Structure will looks like this:
```
.
├── scripts/
│   └── release.ts
└── .github/
    └── workflows/
        └── release.yml
```
4. In `package.json` file add the following line in `script`:
```json
    "release": "cd scripts && node --loader ts-node/esm release.ts"
```
So it would looks like this:
```json
"scripts": {
    "prepack": "nuxt-module-build",
    "dev": "nuxi dev playground",
    "dev:build": "nuxi build playground",
    "dev:prepare": "nuxt-module-build --stub && nuxi prepare playground",
    "release": "cd scripts && node --loader ts-node/esm release.ts"
},
```

## Creating NPM and GitHub tokens

1. Go to [NPM](https://www.npmjs.com/) and follow the instructions to create an access token.
    1. Login and go to `Settings` - `Access Tokens`.
    2. Click on `Generate New Token`.
    3. Give a name for your access token and choose `Automation` type.
    4. Click Generate Token.
    5. Copy the access token and save it.
2. Go to [GitHub](https://github.com) and follow the instructions to create your secret token.
    1. Login and go to your repository `Settings` - `Secrets` - `Actions`.
    2. Click on `New repository secret`.
    3. Your secret name **MUST** be `NPM_AUTH_TOKEN` and paste your NPM token inside `value`.
    4. Click Add secret.


## How to use Automatic Release

1. Run the following commands:
```bash
yarn add ts-node
yarn add fs-extra
yarn add bumpp -g
```
2. When you need to release run the following command:
```bash
yarn release
```
3. You can see the output of the command would look like this:
```
  Current version 1.8.5-beta.20 »                                                          
            major 2.0.0
            minor 1.9.0
            patch 1.8.5
>         next 1.8.5-beta.21
        pre-patch 1.8.6-beta.0
        pre-minor 1.9.0-beta.0
        pre-major 2.0.0-beta.0
           as-is 1.8.5-beta.20
           custom ...
```

::Card{color="info" icon="i-material-symbols-info-outline"}
- For your first publish you may start with a `pre-patch` and then continue with `next` for your next publish.
- You may also use `as-is` to publish the current version.
- You may also use `custom` to publish a custom version.
- You may also use `major`, `minor`, and `patch` to publish a specific version.
::